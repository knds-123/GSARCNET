# -*- coding: utf-8 -*-
"""utils/datsets.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1-APM8b5Ek5zHE85psaNezL42Fib8Hz5P
"""

import torch
from torch.utils.data import Dataset
import pandas as pd
import torchaudio

class TextAudioDataset(Dataset):
    def __init__(self, text_csv_file, audio_csv_file, max_text_length=50, max_audio_length=32):
        self.text_data = pd.read_csv(text_csv_file)
        self.audio_data = pd.read_csv(audio_csv_file)
        self.max_text_length = max_text_length
        self.max_audio_length = max_audio_length
        assert len(self.text_data) == len(self.audio_data)
    def __len__(self):
        return len(self.text_data)
    def __getitem__(self, idx):
        text = self.text_data.iloc[idx]['text_path']
        audio_path = self.audio_data.iloc[idx]['audio_path']
        label = int(self.text_data.iloc[idx]['label'])
        waveform, sr = torchaudio.load(audio_path)
        waveform = waveform.mean(dim=0, keepdim=True)
        return text, waveform, label
